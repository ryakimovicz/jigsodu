/* Jigsaw Puzzle styles */

/* Base Placeholders */
.collected-piece.placeholder {
  visibility: visible;
  opacity: 0.3;
  background: rgba(255, 255, 255, 0.05);
  /* Explicit border props to override generic */
  border-width: 1px;
  border-style: dashed;
  border-color: var(--text-muted);
  pointer-events: auto;
  cursor: default; /* Arrow for empty placeholders */
  box-shadow: none; /* Ensure no shadow */
  transform: none; /* Ensure no scale */
}

/* Selected State - Must come AFTER placeholder or have higher specificity if we want selection to show on placeholders (usually we don't select placeholders but just in case) */
.collected-piece.selected {
  border-color: var(--accent-color) !important; /* Force override */
  box-shadow: 0 0 15px var(--accent-color);
  transform: scale(1.1);
  z-index: 1000;
  opacity: 1; /* Force opacity if selected */
}

/* Jigsaw Mode Transitions */
/* Default Jigsaw Cursors */
.jigsaw-mode .collected-piece {
  cursor: pointer; /* Selectable pieces */
}
.jigsaw-mode .collected-piece.placeholder {
  cursor: default; /* Not selectable */
}

.jigsaw-mode .sudoku-chunk-slot {
  cursor: default; /* Not selectable if empty */
}
.jigsaw-mode .sudoku-chunk-slot.filled {
  cursor: pointer; /* Selectable piece on board */
}

/* Active Selection Cursors: Everything becomes a target */
.jigsaw-mode.selection-active .collected-piece.placeholder {
  cursor: pointer; /* Valid Drop Target */
}

.jigsaw-mode.selection-active .sudoku-chunk-slot {
  cursor: pointer; /* Valid Move/Swap Target */
}

/* Locked Center Place always locked */
.sudoku-chunk-slot[data-slot-index="4"] {
  cursor: not-allowed !important;
  position: relative; /* Ensure pseudo-element is positioned relative to this */
}

/* Overlay effect to ensure it is visible ON TOP of the piece */
.sudoku-chunk-slot[data-slot-index="4"]::after {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.2); /* Darken */
  box-shadow: inset 0 0 15px rgba(0, 0, 0, 0.6); /* Inner shadow */
  pointer-events: none; /* Let clicks pass through (though slot is locked anyway) */
  z-index: 10;
  border: 1px solid rgba(255, 255, 255, 0.2);
}

.sudoku-chunk-slot.selected {
  border: 2px solid var(--accent-color);
  box-shadow: 0 0 15px var(--accent-color);
  z-index: 100;
}

.memory-board,
.collected-piece,
.collected-wrapper {
  transition: all 0.6s cubic-bezier(0.34, 1.56, 0.64, 1); /* Bouncy transition */
}

/* Desktop Jigsaw Expansion */
@media (min-width: 769px) {
  .jigsaw-mode .memory-board {
    width: 420px !important; /* Force larger size */
    height: 420px !important;
  }

  .jigsaw-mode .collected-piece {
    width: 99px !important;
    height: 99px !important;
    /* Move font-size with it */
    font-size: 2rem;
  }

  .jigsaw-mode .collected-wrapper {
    /* Provide more space for larger pieces */
    gap: 15px;
    padding: 10px;
  }

  /* Adjust layout to fit larger board */
  .jigsaw-mode .memory-grid-layout {
    gap: 2rem;
    /* Unlock the middle column to fit the 420px board */
    grid-template-columns: 110px 420px 110px;
  }
}

@media (min-width: 769px) and (max-height: 850px) {
  /* JIGSAW MODE OVERRIDES: 1 Column per side */
  .jigsaw-mode .collected-zone {
    flex-direction: column;
    flex-wrap: nowrap;
    width: 75px; /* Fit single column */
    justify-content: center;
  }

  /* Adjust proximity for the narrower single column */
  .jigsaw-mode .collected-zone.left {
    margin-right: -15px; /* Reset margins for single column */
  }
  .jigsaw-mode .collected-zone.right {
    margin-left: -15px;
  }
}

/* Drag & Drop Styles */
.dragging-clone {
  position: fixed;
  pointer-events: none; /* Let clicks pass through to detect drop target */
  z-index: 9999;
  opacity: 0.9;
  transform: scale(1.1);
  box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
  transition: none; /* No transition during drag for responsiveness */
}

.drop-hover {
  background-color: rgba(255, 255, 255, 0.2);
  border-color: var(--accent-color) !important;
}

/* Error Feedback Styles */
@keyframes shake-red {
  0% {
    transform: translate(1px, 1px) rotate(0deg);
    box-shadow: 0 0 10px red;
    border-color: red;
  }
  10% {
    transform: translate(-1px, -2px) rotate(-1deg);
  }
  20% {
    transform: translate(-3px, 0px) rotate(1deg);
  }
  30% {
    transform: translate(3px, 2px) rotate(0deg);
  }
  40% {
    transform: translate(1px, -1px) rotate(1deg);
  }
  50% {
    transform: translate(-1px, 2px) rotate(-1deg);
  }
  60% {
    transform: translate(-3px, 1px) rotate(0deg);
  }
  70% {
    transform: translate(3px, 1px) rotate(-1deg);
  }
  80% {
    transform: translate(-1px, -1px) rotate(1deg);
  }
  90% {
    transform: translate(1px, 2px) rotate(0deg);
  }
  100% {
    transform: translate(1px, -2px) rotate(-1deg);
    box-shadow: 0 0 10px red;
    border-color: red;
  }
}

.board-error {
  animation: shake-red 0.5s;
  border-color: red !important;
  box-shadow: 0 0 15px red !important;
}

/* Mark specific number as duplicate */
.mini-cell.error-number {
  color: red !important;
  font-weight: bold;
}
